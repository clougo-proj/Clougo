# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

variables:
  isMain: $[eq(variables['Build.SourceBranch'], 'refs/heads/master')]

trigger:
- master

jobs:
  - job: build
    timeoutInMinutes: 5
    pool:
      vmImage: 'Ubuntu-latest'

    steps:
    - checkout: self
      persistCredentials: true
      clean: true

    - script: npm install
      displayName: 'Npm Install'

    - script: npm run build
      displayName: 'Run Build'

    - script: npm run test
      displayName: 'Run tests'

    - publish: generated
      artifact: generated

  - job: deploy
    dependsOn: build
    # condition: and(succeeded(), eq(variables.isMain, true))
    pool:
      vmImage: 'Ubuntu-latest'

    steps:
    - checkout: self
      persistCredentials: true
      clean: true

    - task: DownloadPipelineArtifact@2
      inputs:
        artifact: 'generated'
        path: '$(System.DefaultWorkingDirectory)/generated/'

    - script: npm run test
      displayName: 'Run tests'
